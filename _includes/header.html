<header>
    <nav class="site-nav" aria-label="{{ site.data[site.active_lang].strings.main_nav_aria }}">
        <div class="nav-inner">
            <a href="{{ '/' | relative_url }}" class="site-nav__brand" id="site-logo">{{ site.data[site.active_lang].strings.nav_brand }}</a>
            <div class="site-nav__links">
                <a href="{{ '/' | relative_url }}#studio">
                    {{ site.data[site.active_lang].strings.nav_studio }}
                </a>
                <a href="{{ '/' | relative_url }}#webgl">
                    {{ site.data[site.active_lang].strings.nav_playground }}
                </a>
                <a href="{{ '/' | relative_url }}#stack">
                    {{ site.data[site.active_lang].strings.nav_stack }}
                </a>
                <a href="{{ '/' | relative_url }}#shrine">
                    {{ site.data[site.active_lang].strings.nav_shrine }}
                </a>

                <!-- Language Switcher (Polyglot) -->
                {% assign bare_url = page.url %}
                {% for lang in site.languages %}
                {% capture prefix %}/{{ lang }}{% endcapture %}
                {% if page.url contains prefix %}
                {% assign bare_url = page.url | replace_first: prefix, '' %}
                {% break %}
                {% endif %}
                {% endfor %}
                {% if bare_url == '' %}{% assign bare_url = '/' %}{% endif %}
                <div class="lang-switch-wrapper">
                    {% for lang in site.languages %}
                    {% if lang == site.active_lang %}
                    <span class="lang-switch active">{{ lang }}</span>
                    {% else %}
                    {% if lang == site.default_lang %}
                    <a {% static_href %}href="{{ site.baseurl }}{{ bare_url }}" {% endstatic_href %} class="lang-switch">{{ lang }}</a>
                    {% else %}
                    <a {% static_href %}href="{{ site.baseurl }}/{{ lang }}{{ bare_url }}" {% endstatic_href %}
                        class="lang-switch">{{ lang }}</a>
                    {% endif %}
                    {% endif %}
                    {% endfor %}
                </div>
            </div>
        </div>
    </nav>
</header>

<!-- TASK 1: Save User Preference on Manual Switch -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        var langLinks = document.querySelectorAll('.lang-switch[href]');
        langLinks.forEach(function (link) {
            link.addEventListener('click', function (e) {
                // The language is just the text content (e.g., 'en' or 'uk'), mapped to lowercase
                var selectedLang = this.textContent.trim().toLowerCase();
                localStorage.setItem('preferred_lang', selectedLang);
            });
        });
    });
</script>