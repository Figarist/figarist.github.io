<!-- Viewport & Meta Base -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
<meta name="theme-color" content="#f2f0eb">
<meta name="robots" content="index, follow">
<meta name="google-site-verification" content="Whr2bJTggESM1pyCXLfqwodNQu6cNqk_XKdZ0ix2Tyk" />

<!-- Favicon -->
<link rel="shortcut icon" type="image/png" href="{{ '/assets/images/figaristgithub.png' | relative_url }}">

<!-- Jekyll SEO Tag (Generates Title, OG, Twitter, JSON-LD, Canonical) -->
{% seo %}

<!-- Polyglot: Generates Hreflang logic perfectly -->
{% I18n_Headers %}

<!-- RSS Feeds -->
{% feed_meta %}

<!-- Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preload" as="style"
    href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Fira+Code:wght@400;500;600&display=swap">
<link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Fira+Code:wght@400;500;600&display=swap"
    media="print" onload="this.media='all'">
<noscript>
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Fira+Code:wght@400;500;600&display=swap">
</noscript>

<link rel="stylesheet" href="{{ '/assets/css/styles.css' | relative_url }}">

<!-- Privacy-First Analytics (Zero cookies, no GDPR banner required) -->
<script data-goatcounter="https://figarist.goatcounter.com/count"
    async src="//gc.zgo.at/count.js"></script>

<!-- TASK 2: Auto-Redirect on First Visit & Preference -->
<script>
    (function () {
        try {
            var activeLang = '{{ site.active_lang }}';
            var preferredLang = localStorage.getItem('preferred_lang');
            var targetLang = null;

            // 1. Check if preference exists and is valid
            var supportedLangs = ['en', 'uk', 'ru', 'ko'];
            if (preferredLang) {
                if (!supportedLangs.includes(preferredLang)) {
                    // Fail-safe: if localStorage has junk (like Google Translate strings), clear it
                    localStorage.removeItem('preferred_lang');
                    preferredLang = null;
                } else if (preferredLang !== activeLang) {
                    targetLang = preferredLang;
                }
            } else {
                // 3. First time visitor: Detect browser language
                var browserLang = navigator.language || navigator.userLanguage;
                var languages = navigator.languages || [browserLang];
                var detectedLang = 'en'; // default

                if (languages.some(l => l.startsWith('uk'))) {
                    detectedLang = 'uk';
                } else if (languages.some(l => l.startsWith('ru'))) {
                    detectedLang = 'ru';
                } else if (languages.some(l => l.startsWith('ko'))) {
                    detectedLang = 'ko';
                }

                localStorage.setItem('preferred_lang', detectedLang);
                if (activeLang !== detectedLang) {
                    targetLang = detectedLang;
                }
            }

            // Execute Redirect
            if (targetLang && targetLang !== activeLang) {
                var currentPath = window.location.pathname;
                var pathWithoutLang = currentPath;
                var match = currentPath.match(/^\/(uk|ru|ko)(\/|$)/);
                if (match) {
                    pathWithoutLang = currentPath.substring(match[0].length);
                    if (!pathWithoutLang.startsWith('/')) {
                        pathWithoutLang = '/' + pathWithoutLang;
                    }
                }

                var prefix = targetLang === 'en' ? '' : '/' + targetLang;
                var nextPath = prefix + pathWithoutLang;
                // Add trailing slash check if it had one before (github pages standard)
                nextPath = nextPath.replace(/\/\//g, '/');
                if (nextPath === '') nextPath = '/';

                if (currentPath !== nextPath) {
                    window.location.replace(nextPath + window.location.hash);
                }
            }
        } catch (e) {
            // Failsafe mostly for Safari Private Mode / localStorage quota errors
            console.warn('Language auto-detect failed:', e);
        }
    })();
</script>

</head>