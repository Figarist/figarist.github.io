<header>
    <nav class="site-nav" aria-label="{{ site.data[site.active_lang].strings.main_nav_aria }}">
        <div class="nav-inner">
            <a href="{{ '/' | relative_url }}" class="site-nav__brand" id="site-logo">{{ site.data[site.active_lang].strings.nav_brand }}</a>
            <div class="site-nav__links">
                {% if page.url == '/' or page.url == '/uk/' or page.url == '/ru/' or page.url == '/ko/' %}
                <a href="{{ '/' | relative_url }}#studio">
                    {{ site.data[site.active_lang].strings.nav_studio }}
                </a>
                <a href="{{ '/' | relative_url }}#webgl">
                    {{ site.data[site.active_lang].strings.nav_playground }}
                </a>
                <a href="{{ '/' | relative_url }}#stack">
                    {{ site.data[site.active_lang].strings.nav_stack }}
                </a>
                <a href="{{ '/' | relative_url }}#shrine">
                    {{ site.data[site.active_lang].strings.nav_shrine }}
                </a>
                {% endif %}

                <!-- Language Switcher (Polyglot) -->
                {% assign bare_url = page.url %}
                {% for lang in site.languages %}
                {% capture prefix %}/{{ lang }}{% endcapture %}
                {% if page.url contains prefix %}
                {% assign bare_url = page.url | replace_first: prefix, '' %}
                {% break %}
                {% endif %}
                {% endfor %}
                {% if bare_url == '' %}{% assign bare_url = '/' %}{% endif %}
                
                <button id="search-trigger" class="site-nav__search-trigger" aria-label="{{ site.data[site.active_lang].strings.search_label | default: 'Search' }}" title="Search (Cmd+K)">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                </button>

                <div class="lang-switch-wrapper" translate="no">
                    {% for lang in site.languages %}
                    {% if lang == site.active_lang %}
                    <span class="lang-switch active" data-lang="{{ lang }}">{{ lang }}</span>
                    {% else %}
                    {% if lang == site.default_lang %}
                    <a {% static_href %}href="{{ site.baseurl }}{{ bare_url }}" {% endstatic_href %} 
                        class="lang-switch" data-lang="{{ lang }}">{{ lang }}</a>
                    {% else %}
                    <a {% static_href %}href="{{ site.baseurl }}/{{ lang }}{{ bare_url }}" {% endstatic_href %}
                        class="lang-switch" data-lang="{{ lang }}">{{ lang }}</a>
                    {% endif %}
                    {% endif %}
                    {% endfor %}
                </div>
            </div>
        </div>
    </nav>
</header>

<!-- TASK 1: Save User Preference on Manual Switch -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        var langLinks = document.querySelectorAll('.lang-switch[data-lang]');
        langLinks.forEach(function (link) {
            link.addEventListener('click', function (e) {
                // Use data-lang attribute instead of textContent 
                // to avoid issues with Google Translate or browser-based translation.
                var selectedLang = this.getAttribute('data-lang');
                if (selectedLang) {
                    localStorage.setItem('preferred_lang', selectedLang.toLowerCase());
                }
            });
        });
    });
</script>