<!-- SEO: Primary Meta -->
<title>{% if page.title %}{{ page.title }} â€” {% endif %}Figarist{{ site.data[site.active_lang].strings.head_title_suffix
    }}</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
<meta name="description" content="{{ site.data[site.active_lang].strings.head_desc }}">
<meta name="keywords" content="{{ site.data[site.active_lang].strings.head_keywords }}">
<meta name="author" content="{{ site.data[site.active_lang].strings.head_author }}">
<meta name="theme-color" content="#f2f0eb">
<meta name="robots" content="index, follow">
<link rel="canonical" href="{{ page.url | replace:'index.html','' | absolute_url }}">


<!-- SEO: Hreflang -->
{% assign bare_url = page.url | remove_first: '/uk' %}
{% if bare_url == '' %}{% assign bare_url = '/' %}{% endif %}
<link rel="alternate" {% static_href %}href="{{ site.url }}{{ site.baseurl }}{{ bare_url }}" {% endstatic_href %}
    hreflang="en">
<link rel="alternate" {% static_href %}href="{{ site.url }}{{ site.baseurl }}/uk{{ bare_url }}" {% endstatic_href %}
    hreflang="uk">
<link rel="alternate" {% static_href %}href="{{ site.url }}{{ site.baseurl }}{{ bare_url }}" {% endstatic_href %}
    hreflang="x-default">

<!-- SEO: Open Graph -->
<meta property="og:type" content="website">
<meta property="og:site_name" content="Figarist">
<meta property="og:title" content="Figarist{{ site.data[site.active_lang].strings.head_title_suffix }}">
<meta property="og:description" content="{{ site.data[site.active_lang].strings.head_og_desc }}">
<meta property="og:url" content="{{ page.url | absolute_url }}">
<meta property="og:locale" content="{{ site.data[site.active_lang].strings.head_og_locale }}">
{% for alternate in site.data[site.active_lang].strings.head_og_locale_alternates %}
<meta property="og:locale:alternate" content="{{ alternate }}">
{% endfor %}

<!-- SEO: Twitter Card -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Figarist{{ site.data[site.active_lang].strings.head_title_suffix }}">
<meta name="twitter:description" content="{{ site.data[site.active_lang].strings.head_desc }}">

<!-- SEO: JSON-LD Structured Data (Person) -->
<script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Person",
        "name": "Ihor",
        "alternateName": "Figarist",
        "url": "https://figarist.github.io",
        "jobTitle": ["Indie Game Developer", "Computer Science Teacher"],
        "knowsAbout": ["Unity", "C#", "Game Development", "Wear OS", "Python", "Computer Science Education"],
        "address": {
            "@type": "PostalAddress",
            "addressLocality": "Zmiiv",
            "addressCountry": "UA"
        },
        "affiliatedOrganization": {
            "@type": "Organization",
            "name": "Wrist & Pocket Studio",
            "url": "https://wristandpocket.github.io"
        },
        "sameAs": [
            "https://github.com/Figarist",
            "https://www.youtube.com/@proVR_ua"
        ]
    }
    </script>

<!-- SEO: JSON-LD Structured Data (WebSite) -->
<script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "Figarist",
        "url": "https://figarist.github.io",
        "inLanguage": ["en", "uk", "ru", "ko"],
        "description": "Personal site of Ihor (Figarist). Indie game developer and computer science teacher."
    }
    </script>

<!-- Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link
    href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Fira+Code:wght@400;500;600&display=swap"
    rel="stylesheet">

<link rel="stylesheet" href="{{ '/styles.css' | relative_url }}">
<meta name="google-site-verification" content="Whr2bJTggESM1pyCXLfqwodNQu6cNqk_XKdZ0ix2Tyk" />

<!-- TASK 2: Auto-Redirect on First Visit & Preference -->
<script>
    (function () {
        try {
            var activeLang = '{{ site.active_lang }}';
            var preferredLang = localStorage.getItem('preferred_lang');
            var targetLang = null;

            // 1. Check if preference exists
            if (preferredLang) {
                if (preferredLang !== activeLang) {
                    targetLang = preferredLang;
                }
            } else {
                // 3. First time visitor: Detect browser language
                var browserLang = navigator.language || navigator.userLanguage;
                var languages = navigator.languages || [browserLang];
                var detectedLang = 'en'; // default

                if (languages.some(l => l.startsWith('uk'))) {
                    detectedLang = 'uk';
                } else if (languages.some(l => l.startsWith('ru'))) {
                    detectedLang = 'ru';
                } else if (languages.some(l => l.startsWith('ko'))) {
                    detectedLang = 'ko';
                }

                localStorage.setItem('preferred_lang', detectedLang);
                if (activeLang !== detectedLang) {
                    targetLang = detectedLang;
                }
            }

            // Execute Redirect
            if (targetLang && targetLang !== activeLang) {
                var currentPath = window.location.pathname;
                var pathWithoutLang = currentPath;
                var match = currentPath.match(/^\/(uk|ru|ko)(\/|$)/);
                if (match) {
                    pathWithoutLang = currentPath.substring(match[0].length);
                    if (!pathWithoutLang.startsWith('/')) {
                        pathWithoutLang = '/' + pathWithoutLang;
                    }
                }

                var prefix = targetLang === 'en' ? '' : '/' + targetLang;
                var nextPath = prefix + pathWithoutLang;
                // Add trailing slash check if it had one before (github pages standard)
                nextPath = nextPath.replace(/\/\//g, '/');
                if (nextPath === '') nextPath = '/';

                if (currentPath !== nextPath) {
                    window.location.replace(nextPath + window.location.hash);
                }
            }
        } catch (e) {
            // Failsafe mostly for Safari Private Mode / localStorage quota errors
            console.warn('Language auto-detect failed:', e);
        }
    })();
</script>

</head>